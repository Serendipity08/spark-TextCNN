# CODEX.md  

# （极其重要：本文件是本项目中 Codex / AI 编程助手的最高约束）



> 本文件用于约束 Codex（Cursor 中的 AI 编程模型）在本项目中的行为规范、工程标准与产品边界。

>  

> 注意：每次进行重要编码、重构、架构设计前，必须显式提醒 Codex 阅读并遵守本文件。



---



## 一、Communication（沟通与语言）



\- 永远使用 \*\*简体中文\*\* 进行思考、解释、代码注释与回复

\- 不要使用中英混杂的变量名或注释

\- 所有对用户可见的文案，必须符合「情绪礼物」产品调性：克制、真诚、不浮夸



---



## 二、Product First（产品优先原则）



\- 本项目是一个 \*\*真实要上线、要产生收益的产品\*\*

\- 所有技术决策必须服务于：

&nbsp; - 可上线

&nbsp; - 可维护

&nbsp; - 可扩展

&nbsp; - 可商业化

\- 注意：不允许为了“技术炫技”引入复杂架构

\- 注意：不允许引入未经讨论的重度依赖或实验性方案



\*\*任何设计都应优先回答：\*\*

\- 这个设计是否真的服务用户体验？

\- 是否有助于更快上线和验证收益？

\- 是否能被单人或小团队长期维护？



---



## 三、Documentation（文档规范）



\- 所有文档统一使用 \*\*Markdown\*\*

\- 文档必须使用 \*\*中文\*\*

\- 目录约定：

&nbsp; - `docs/`  

&nbsp;   - 正式文档（PRD、架构说明、接口文档、部署说明）

&nbsp; - `discuss/`  

&nbsp;   - 方案讨论、备选设计、评审草稿、探索性文档

\- 任何重要模块：

&nbsp; - 必须至少有一份说明文档

&nbsp; - 文档应优先于代码生成



---



## 四、Code Architecture（代码架构与质量）



### 4.1 文件与目录硬性约束（必须遵守）



\- \*\*动态语言（JS / TS / Python）\*\*

&nbsp; - 单文件尽量 ≤ 300 行

\- \*\*静态语言（Java / Go / Rust）\*\*

&nbsp; - 单文件尽量 ≤ 400 行

\- 单层目录下：

&nbsp; - 文件数 ≤ 8 个

&nbsp; - 超出必须拆分子模块



---



### 4.2 必须持续警惕的「坏味道」



一旦识别出以下问题，\*\*必须主动提醒用户并给出优化建议\*\*：



1\. 僵化（Rigidity）

2\. 冗余（Redundancy）

3\. 循环依赖（Circular Dependency）

4\. 脆弱性（Fragility）

5\. 晦涩性（Obscurity）

6\. 数据泥团（Data Clump）

7\. 不必要的复杂性（Needless Complexity）



注意：\*\*不允许在明知存在坏味道的情况下继续堆功能代码\*\*



---



## 五、Technology Stack（本项目技术栈约束）



### 5.1 后端（核心）



\- 语言：\*\*Java\*\*

\- 框架：\*\*Spring Boot（单体架构，禁止微服务化）\*\*

\- 构建工具：\*\*Maven\*\*

\- 数据库：\*\*MySQL\*\*

\- 可选组件（按阶段启用）：

&nbsp; - Redis（缓存 / 限流 / 幂等）

&nbsp; - MQ（仅在音频合成等耗时任务引入）



禁止：

\- 过早拆服务

\- 过早引入 MQ / 分布式事务

\- 复杂 DDD / CQRS（除非明确需要并经确认）



---



### 5.2 前端（微信小程序）



\- 平台：\*\*微信小程序（原生）\*\*

\- 技术：

&nbsp; - WXML

&nbsp; - WXSS

&nbsp; - TypeScript / JavaScript

\- 注意：不允许引入 Web-only 框架或无法在小程序运行的依赖

\- 所有页面必须以「送礼 / 接收 / 情绪沉浸体验」为核心



---



## 六、AI 能力使用边界（非常重要）



### 6.1 V1 阶段原则



\- 允许使用 \*\*Mock 数据\*\*

\- 允许使用 \*\*假 AI 结果\*\*

\- 目标是：

&nbsp; - 跑通流程

&nbsp; - 验证体验

&nbsp; - 支持商业闭环



注意：不强制接真实 ASR / TTS / LLM



---



### 6.2 后续阶段（需确认）



\- ASR：语音 → 文字

\- LLM：文案润色

\- TTS：音色朗读

\- 混音：背景音乐 + 人声



注意：每引入一项 AI 能力：

\- 必须说明成本

\- 必须说明异步策略

\- 必须说明失败兜底



---



## 七、Run \& Debug（运行与调试）



\- 所有运行、调试、启动、停止操作：

&nbsp; - \*\*优先通过 scripts/ 目录下的脚本完成；如 scripts/ 尚未提供，请先补齐脚本再运行\*\*

\- 不允许：

&nbsp; - 直接在终端手敲 `java -jar` / `mvn spring-boot:run`

\- 所有日志：

&nbsp; - 统一输出到 `logs/` 目录

&nbsp; - 必须支持本地查看



---



## 八、Coding Style（编码风格）



\- 明确分层：

&nbsp; - Controller

&nbsp; - Service

&nbsp; - Domain / Entity

&nbsp; - Repository

\- 禁止：

&nbsp; - Controller 写业务

&nbsp; - Service 直接操作 HTTP 细节

\- 方法职责单一

\- 命名必须语义清晰，宁可长，不可模糊



---



## 九、AI 协作方式约束（给 Codex 的重要提醒）



\- Codex 的角色是：\*\*工程执行者\*\*

\- 不允许：

&nbsp; - 擅自改变产品设计

&nbsp; - 擅自扩展需求范围

&nbsp; - 擅自引入新技术栈

\- 如果发现设计不合理：

&nbsp; - \*\*先提出问题\*\*

&nbsp; - \*\*等待用户确认后再修改\*\*



---



## 十、最终原则（最高优先级）



> \*\*稳定性 > 可维护性 > 可扩展性 > 技术先进性\*\*



> \*\*能赚钱、能上线、能长期维护  

比“看起来很高级”重要得多\*\*



---







